<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Defensa Galáctica Extrema</title>
    <style>
        /* Estilos generales */
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: manipulation;
            background: #000;
        }
        
        /* Fondo de galaxia */
        #game-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000 url('https://raw.githubusercontent.com/CUPUL-MIU-04/GAMER-HTML/master/Deferso-De-Galaxia/assets/background.jpg') no-repeat center center;
            background-size: cover;
            z-index: -1;
        }
        
        /* Estrellas (partículas) */
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            z-index: 0;
            animation: twinkle 5s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 1; }
        }
        
        /* Contenedor principal */
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Menú principal */
        #main-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        .menu-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: #fff;
            text-shadow: 0 0 10px #0ff;
        }
        
        .menu-button {
            background-color: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            padding: 12px 24px;
            margin: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            width: 200px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            background-color: #0ff;
            color: #000;
        }
        
        /* Submenús */
        .submenu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 400;
        }
        
        .submenu-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: #0ff;
            text-shadow: 0 0 8px #0ff;
        }
        
        .submenu-content {
            max-width: 80%;
            max-height: 60%;
            overflow-y: auto;
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 10px;
            border: 1px solid #0ff;
            border-radius: 5px;
            color: #fff;
        }
        
        .back-button {
            background-color: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            padding: 10px 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .back-button:hover {
            background-color: #0ff;
            color: #000;
        }
        
        /* Configuración */
        .option-group {
            margin: 15px 0;
            text-align: left;
        }
        
        .option-label {
            display: block;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .option-select {
            background-color: #000;
            color: #0ff;
            border: 1px solid #0ff;
            padding: 5px;
            width: 100%;
            font-family: 'Courier New', monospace;
        }
        
        /* Elementos del juego */
        #defender {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: url('https://raw.githubusercontent.com/CUPUL-MIU-04/GAMER-HTML/master/Deferso-De-Galaxia/assets/Nave.png') no-repeat center center;
            background-size: contain;
            z-index: 10;
        }
        
        .enemy {
            position: absolute;
            width: 50px;
            height: 50px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 5;
        }
        
        .enemy-type1 {
            background-image: url('https://raw.githubusercontent.com/CUPUL-MIU-04/GAMER-HTML/master/Deferso-De-Galaxia/assets/Enemigo.png');
        }
        
        .enemy-type2 {
            background-image: url('https://raw.githubusercontent.com/CUPUL-MIU-04/GAMER-HTML/master/Deferso-De-Galaxia/assets/Enemigo2.png');
        }
        
        .enemy-type3 {
            background-image: url('https://raw.githubusercontent.com/CUPUL-MIU-04/GAMER-HTML/master/Deferso-De-Galaxia/assets/Enemigo3.png');
        }
        
        .bullet {
            position: absolute;
            z-index: 2;
        }
        
        .player-bullet {
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #ff0, #f80);
            box-shadow: 0 0 10px #ff0;
            border-radius: 4px;
        }
        
        .player-special-bullet {
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #f00, #800);
            box-shadow: 0 0 15px #f00;
            border-radius: 50%;
        }
        
        .enemy-bullet {
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #f00, #800);
            box-shadow: 0 0 10px #f00;
            border-radius: 4px;
        }
        
        .fireball {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #f80, #f00);
            box-shadow: 0 0 20px #f80;
            border-radius: 50%;
            animation: pulse-fireball 0.5s infinite alternate;
        }
        
        @keyframes pulse-fireball {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }
        
        #score {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
            color: #fff;
            text-shadow: 0 0 5px #0ff;
            z-index: 20;
        }
        
        #lives {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 18px;
            color: #fff;
            text-shadow: 0 0 5px #0ff;
            z-index: 20;
        }
        
        #level {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            color: #fff;
            text-shadow: 0 0 5px #0ff;
            z-index: 20;
        }
        
        #weapon-info {
            position: absolute;
            top: 40px;
            left: 10px;
            font-size: 16px;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
            z-index: 20;
        }
        
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            color: #f00;
            display: none;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            z-index: 100;
            border: 2px solid #f00;
        }
        
        #level-up {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            color: #0f0;
            display: none;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            z-index: 90;
            animation: pulse 1s infinite;
            border: 2px solid #0f0;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Controles */
        #controls {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: none;
            justify-content: center;
            gap: 20px;
            z-index: 15;
        }
        
        .control-btn {
            background-color: rgba(0, 255, 255, 0.3);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            user-select: none;
            touch-action: manipulation;
            border: 2px solid #0ff;
        }
        
        /* Efectos */
        .explosion {
            position: absolute;
            width: 60px;
            height: 60px;
            background: url('https://raw.githubusercontent.com/CUPUL-MIU-04/GAMER-HTML/master/Deferso-De-Galaxia/assets/explosion.png') no-repeat center center;
            background-size: contain;
            z-index: 8;
            animation: explode 0.5s forwards;
        }
        
        @keyframes explode {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            #controls {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo de galaxia -->
    <div id="game-background"></div>
    
    <!-- Estrellas (partículas) -->
    <div id="stars-container"></div>
    
    <div id="game-container">
        <!-- Menú principal -->
        <div id="main-menu">
            <h1 class="menu-title">DEFENSA GALÁCTICA</h1>
            <button id="start-game-btn" class="menu-button">COMENZAR</button>
            <button id="settings-btn" class="menu-button">CONFIGURACIÓN</button>
            <button id="credits-btn" class="menu-button">CRÉDITOS</button>
        </div>
        
        <!-- Submenú de configuración -->
        <div id="settings-menu" class="submenu">
            <h2 class="submenu-title">CONFIGURACIÓN</h2>
            <div class="submenu-content">
                <div class="option-group">
                    <label class="option-label">Sonido:</label>
                    <select id="sound-option" class="option-select">
                        <option value="on">Activado</option>
                        <option value="off">Desactivado</option>
                    </select>
                </div>
                
                <div class="option-group">
                    <label class="option-label">Controles Móvil:</label>
                    <select id="mobile-controls" class="option-select">
                        <option value="swipe">Deslizar (Izq/Der)</option>
                        <option value="buttons">Botones Virtuales</option>
                    </select>
                </div>
                
                <div class="option-group">
                    <label class="option-label">Controles PC:</label>
                    <select id="pc-controls" class="option-select">
                        <option value="mouse">Ratón</option>
                        <option value="keys">Teclado (Flechas)</option>
                    </select>
                </div>
            </div>
            <button id="back-from-settings" class="back-button">VOLVER</button>
        </div>
        
        <!-- Submenú de créditos -->
        <div id="credits-menu" class="submenu">
            <h2 class="submenu-title">CRÉDITOS</h2>
            <div class="submenu-content">
                <p><strong>Versión:</strong> 3.0 - Sistema de Armas</p>
                <p><strong>Creador:</strong> [Luis04]</p>
                <p><strong>Plataformas:</strong> Android y Computadora</p>
                
                <h3>Novedades:</h3>
                <ul style="text-align: left; padding-left: 20px;">
                    <li>Sistema de armas especiales</li>
                    <li>3 tipos de enemigos con diferentes ataques</li>
                    <li>Efectos visuales mejorados</li>
                    <li>Posición de nave ajustada</li>
                    <li>Dificultad balanceada</li>
                </ul>
                
                <h3>Controles:</h3>
                <p>Móvil: Deslizar o botones virtuales</p>
                <p>PC: Ratón o teclado (flechas)</p>
            </div>
            <button id="back-from-credits" class="back-button">VOLVER</button>
        </div>
        
        <!-- Controles móviles -->
        <div id="controls">
            <div class="control-btn" id="left-btn">←</div>
            <div class="control-btn" id="right-btn">→</div>
        </div>
        
        <!-- Elementos del juego -->
        <div id="score">Puntuación: 0</div>
        <div id="level">Ronda: Sencillo</div>
        <div id="lives">Vidas: ❤❤❤</div>
        <div id="weapon-info">Arma: Básica</div>
        <div id="defender"></div>
        <div id="level-up"></div>
        <div id="game-over">
            GAME OVER<br>
            Puntuación: <span id="final-score">0</span><br>
            Ronda alcanzada: <span id="final-level">Sencillo</span><br>
            <button id="restart-button">REINICIAR</button>
            <button id="menu-button">MENÚ</button>
        </div>
    </div>

    <script>
        // =============================================
        // ELEMENTOS DEL JUEGO Y CONFIGURACIÓN
        // =============================================
        const gameContainer = document.getElementById('game-container');
        const defender = document.getElementById('defender');
        const scoreDisplay = document.getElementById('score');
        const livesDisplay = document.getElementById('lives');
        const levelDisplay = document.getElementById('level');
        const weaponInfo = document.getElementById('weapon-info');
        const gameOverDisplay = document.getElementById('game-over');
        const levelUpDisplay = document.getElementById('level-up');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalLevelDisplay = document.getElementById('final-level');
        const restartButton = document.getElementById('restart-button');
        const menuButton = document.getElementById('menu-button');
        const starsContainer = document.getElementById('stars-container');
        
        // Elementos del menú
        const mainMenu = document.getElementById('main-menu');
        const startGameBtn = document.getElementById('start-game-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const creditsBtn = document.getElementById('credits-btn');
        const settingsMenu = document.getElementById('settings-menu');
        const creditsMenu = document.getElementById('credits-menu');
        const backFromSettings = document.getElementById('back-from-settings');
        const backFromCredits = document.getElementById('back-from-credits');
        
        // Controles
        const controls = document.getElementById('controls');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        
        // Opciones de configuración
        const soundOption = document.getElementById('sound-option');
        const mobileControls = document.getElementById('mobile-controls');
        const pcControls = document.getElementById('pc-controls');
        
        // Niveles de dificultad
        const levels = [
            { name: "Sencillo", enemySpeed: 1.0, spawnRate: 2000, fireRate: 2000, lives: 3, scoreRequired: 100 },
            { name: "Fácil", enemySpeed: 1.5, spawnRate: 1500, fireRate: 1500, lives: 3, scoreRequired: 200 },
            { name: "Normal", enemySpeed: 2.0, spawnRate: 1200, fireRate: 1200, lives: 5, scoreRequired: 400 },
            { name: "Difícil", enemySpeed: 2.5, spawnRate: 900, fireRate: 900, lives: 5, scoreRequired: 800 },
            { name: "Ultra", enemySpeed: 3.0, spawnRate: 700, fireRate: 700, lives: 7, scoreRequired: 1500 },
            { name: "Extremo", enemySpeed: 3.5, spawnRate: 500, fireRate: 500, lives: 10, scoreRequired: 3000 },
            { name: "Más Extremo", enemySpeed: 4.0, spawnRate: 300, fireRate: 300, lives: 15, scoreRequired: 5000 }
        ];
        
        // Configuración del jugador
        const playerConfig = {
            speed: 15,
            bulletSpeed: 10,
            fireRate: 300,
            weapon: 'basic', // basic, triple, fire, machinegun
            weaponDuration: 0,
            weaponCooldown: 0
        };
        
        // Variables del juego
        let score = 0;
        let lives = 3;
        let currentLevel = 0;
        let gameActive = false;
        let defenderPosition = window.innerWidth / 2;
        let enemies = [];
        let playerBullets = [];
        let enemyBullets = [];
        let gameIntervals = [];
        let touchStartX = 0;
        let lastTouchX = 0;
        let isDragging = false;
        let enemiesDestroyed = 0;
        let moveLeft = false;
        let moveRight = false;
        let lastShotTime = 0;
        
        // Configuración del usuario
        let config = {
            sound: 'on',
            mobileControls: 'swipe',
            pcControls: 'mouse'
        };
        
        // Detectar dispositivo
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // =============================================
        // FUNCIONES DE INICIALIZACIÓN
        // =============================================
        
        // Crear estrellas para el fondo
        function createStars() {
            const starsCount = 100;
            const containerWidth = window.innerWidth;
            const containerHeight = window.innerHeight;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // Tamaño aleatorio entre 1px y 3px
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // Posición aleatoria
                star.style.left = `${Math.random() * containerWidth}px`;
                star.style.top = `${Math.random() * containerHeight}px`;
                
                // Opacidad aleatoria
                star.style.opacity = Math.random();
                
                // Animación de parpadeo con duración aleatoria
                star.style.animationDuration = `${Math.random() * 5 + 5}s`;
                
                starsContainer.appendChild(star);
            }
        }
        
        // =============================================
        // FUNCIONES DEL MENÚ
        // =============================================
        
        function showMainMenu() {
            mainMenu.style.display = 'flex';
            gameOverDisplay.style.display = 'none';
            resetGameState();
        }
        
        function showSettings() {
            mainMenu.style.display = 'none';
            settingsMenu.style.display = 'flex';
            
            // Cargar configuración actual
            soundOption.value = config.sound;
            mobileControls.value = config.mobileControls;
            pcControls.value = config.pcControls;
        }
        
        function showCredits() {
            mainMenu.style.display = 'none';
            creditsMenu.style.display = 'flex';
        }
        
        function backToMainMenu() {
            settingsMenu.style.display = 'none';
            creditsMenu.style.display = 'none';
            mainMenu.style.display = 'flex';
            
            // Guardar configuración
            config = {
                sound: soundOption.value,
                mobileControls: mobileControls.value,
                pcControls: pcControls.value
            };
            
            // Aplicar controles
            setupControls();
        }
        
        function startGame() {
            mainMenu.style.display = 'none';
            resetGame();
        }
        
        // =============================================
        // FUNCIONES DEL JUEGO
        // =============================================
        
        function setupControls() {
            // Limpiar eventos anteriores
            gameContainer.removeEventListener('touchstart', handleTouchStart);
            gameContainer.removeEventListener('touchmove', handleTouchMove);
            gameContainer.removeEventListener('touchend', handleTouchEnd);
            gameContainer.removeEventListener('mousedown', handleMouseDown);
            gameContainer.removeEventListener('mousemove', handleMouseMove);
            gameContainer.removeEventListener('mouseup', handleMouseUp);
            document.removeEventListener('keydown', handleKeyDown);
            document.removeEventListener('keyup', handleKeyUp);
            leftBtn.removeEventListener('touchstart', handleLeftStart);
            leftBtn.removeEventListener('touchend', handleLeftEnd);
            rightBtn.removeEventListener('touchstart', handleRightStart);
            rightBtn.removeEventListener('touchend', handleRightEnd);
            
            // Configurar controles para móvil
            if (isMobile) {
                controls.style.display = config.mobileControls === 'buttons' ? 'flex' : 'none';
                
                if (config.mobileControls === 'swipe') {
                    gameContainer.addEventListener('touchstart', handleTouchStart);
                    gameContainer.addEventListener('touchmove', handleTouchMove);
                    gameContainer.addEventListener('touchend', handleTouchEnd);
                } else {
                    leftBtn.addEventListener('touchstart', handleLeftStart);
                    leftBtn.addEventListener('touchend', handleLeftEnd);
                    rightBtn.addEventListener('touchstart', handleRightStart);
                    rightBtn.addEventListener('touchend', handleRightEnd);
                }
            } 
            // Configurar controles para PC
            else {
                if (config.pcControls === 'mouse') {
                    gameContainer.addEventListener('mousedown', handleMouseDown);
                    gameContainer.addEventListener('mousemove', handleMouseMove);
                    gameContainer.addEventListener('mouseup', handleMouseUp);
                } else {
                    document.addEventListener('keydown', handleKeyDown);
                    document.addEventListener('keyup', handleKeyUp);
                }
            }
        }
        
        // Control táctil (deslizar)
        function handleTouchStart(e) {
            if (!gameActive) return;
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            lastTouchX = touchStartX;
            isDragging = true;
        }
        
        function handleTouchMove(e) {
            if (!gameActive || !isDragging) return;
            e.preventDefault();
            
            const touchX = e.touches[0].clientX;
            const deltaX = touchX - lastTouchX;
            
            defenderPosition += deltaX * 1.5;
            updateDefenderPosition();
            
            lastTouchX = touchX;
        }
        
        function handleTouchEnd() {
            isDragging = false;
        }
        
        // Control con ratón
        function handleMouseDown(e) {
            if (!gameActive) return;
            touchStartX = e.clientX;
            lastTouchX = touchStartX;
            isDragging = true;
        }
        
        function handleMouseMove(e) {
            if (!gameActive || !isDragging) return;
            
            const mouseX = e.clientX;
            const deltaX = mouseX - lastTouchX;
            
            defenderPosition += deltaX * 1.5;
            updateDefenderPosition();
            
            lastTouchX = mouseX;
        }
        
        function handleMouseUp() {
            isDragging = false;
        }
        
        // Control con teclado
        function handleKeyDown(e) {
            if (!gameActive) return;
            
            if (e.key === 'ArrowLeft' || e.key === 'a') moveLeft = true;
            if (e.key === 'ArrowRight' || e.key === 'd') moveRight = true;
        }
        
        function handleKeyUp(e) {
            if (e.key === 'ArrowLeft' || e.key === 'a') moveLeft = false;
            if (e.key === 'ArrowRight' || e.key === 'd') moveRight = false;
        }
        
        // Control con botones virtuales
        function handleLeftStart() {
            moveLeft = true;
        }
        
        function handleLeftEnd() {
            moveLeft = false;
        }
        
        function handleRightStart() {
            moveRight = true;
        }
        
        function handleRightEnd() {
            moveRight = false;
        }
        
        // Mover defensor
        function updateDefenderPosition() {
            defenderPosition = Math.max(30, Math.min(window.innerWidth - 30, defenderPosition));
            defender.style.left = `${defenderPosition - 30}px`;
        }
        
        function shoot() {
            if (!gameActive) return;
            
            const now = Date.now();
            if (now - lastShotTime < playerConfig.fireRate) return;
            lastShotTime = now;
            
            // Actualizar estado del arma
            updateWeaponState();
            
            // Disparo según el arma actual
            switch(playerConfig.weapon) {
                case 'triple':
                    shootTriple();
                    break;
                case 'fire':
                    shootFire();
                    break;
                case 'machinegun':
                    shootMachinegun();
                    break;
                default: // basic
                    shootBasic();
                    break;
            }
        }
        
        function shootBasic() {
            createPlayerBullet(defenderPosition, 'basic');
        }
        
        function shootTriple() {
            createPlayerBullet(defenderPosition - 20, 'triple');
            createPlayerBullet(defenderPosition, 'triple');
            createPlayerBullet(defenderPosition + 20, 'triple');
        }
        
        function shootFire() {
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    createPlayerBullet(defenderPosition - 15 + (i * 15), 'fire');
                }, i * 100);
            }
        }
        
        function shootMachinegun() {
            createPlayerBullet(defenderPosition - 10 + Math.random() * 20, 'machinegun');
        }
        
        function createPlayerBullet(x, weaponType) {
            const bullet = document.createElement('div');
            
            if (weaponType === 'fire') {
                bullet.className = 'bullet player-special-bullet fireball';
            } else if (weaponType === 'triple') {
                bullet.className = 'bullet player-special-bullet';
            } else {
                bullet.className = 'bullet player-bullet';
            }
            
            bullet.style.left = `${x - 4}px`;
            bullet.style.bottom = '90px';
            gameContainer.appendChild(bullet);
            
            playerBullets.push({
                element: bullet,
                x: x - 4,
                y: window.innerHeight - 90,
                speed: playerConfig.bulletSpeed * (weaponType === 'machinegun' ? 1.5 : 1),
                damage: weaponType === 'fire' ? 3 : 1,
                weaponType: weaponType
            });
        }
        
        function updateWeaponState() {
            // Reducir duración del arma especial
            if (playerConfig.weapon !== 'basic') {
                playerConfig.weaponDuration -= playerConfig.fireRate;
                
                if (playerConfig.weaponDuration <= 0) {
                    playerConfig.weapon = 'basic';
                    playerConfig.weaponCooldown = 5000; // 5 segundos de cooldown
                    weaponInfo.textContent = "Arma: Básica";
                    weaponInfo.style.color = "#0f0";
                }
            }
            // Reducir cooldown
            else if (playerConfig.weaponCooldown > 0) {
                playerConfig.weaponCooldown -= playerConfig.fireRate;
            }
        }
        
        function enemyShoot(enemy, enemyType) {
            if (!gameActive || Math.random() > 0.3) return;
            
            // Disparo según tipo de enemigo
            if (enemyType === 1) { // [{§}] - Disparo triple
                createEnemyBullet(enemy.x + 20, enemy.y + 40, -15);
                createEnemyBullet(enemy.x + 20, enemy.y + 40, 0);
                createEnemyBullet(enemy.x + 20, enemy.y + 40, 15);
            } 
            else if (enemyType === 2) { // [ × ] - Línea de bolas de fuego
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        createEnemyFireball(enemy.x + 20, enemy.y + 40);
                    }, i * 200);
                }
            }
            else { // (@) - Metralleta
                createEnemyBullet(enemy.x + 20, enemy.y + 40, Math.random() * 30 - 15);
            }
        }
        
        function createEnemyBullet(x, y, angleOffset = 0) {
            const bullet = document.createElement('div');
            bullet.className = 'bullet enemy-bullet';
            bullet.style.left = `${x}px`;
            bullet.style.top = `${y}px`;
            gameContainer.appendChild(bullet);
            
            enemyBullets.push({
                element: bullet,
                x: x,
                y: y,
                speed: levels[currentLevel].enemySpeed * 2,
                angleOffset: angleOffset
            });
        }
        
        function createEnemyFireball(x, y) {
            const fireball = document.createElement('div');
            fireball.className = 'bullet fireball';
            fireball.style.left = `${x}px`;
            fireball.style.top = `${y}px`;
            gameContainer.appendChild(fireball);
            
            enemyBullets.push({
                element: fireball,
                x: x,
                y: y,
                speed: levels[currentLevel].enemySpeed * 1.5,
                angleOffset: 0,
                isFireball: true
            });
        }
        
        function createEnemy() {
            if (!gameActive) return;
            
            const enemyTypes = [
                { class: 'enemy-type1', type: 1, health: 2 }, // [{§}] - Triple disparo
                { class: 'enemy-type2', type: 2, health: 3 }, // [ × ] - Bolas de fuego
                { class: 'enemy-type3', type: 3, health: 1 }  // (@) - Metralleta
            ];
            
            const typeIndex = Math.min(Math.floor(enemiesDestroyed / 15), enemyTypes.length - 1);
            const enemyType = enemyTypes[typeIndex];
            
            const enemy = document.createElement('div');
            enemy.className = `enemy ${enemyType.class}`;
            
            const xPos = 30 + Math.random() * (window.innerWidth - 60);
            enemy.style.left = `${xPos}px`;
            enemy.style.top = '-50px';
            gameContainer.appendChild(enemy);
            
            const level = levels[currentLevel];
            const health = enemyType.health + Math.floor(enemiesDestroyed / 30);
            
            enemies.push({
                element: enemy,
                x: xPos,
                y: -50,
                speed: level.enemySpeed + Math.random() * (currentLevel * 0.3),
                shootDelay: Math.floor(Math.random() * 100) + 50,
                health: health,
                points: health * 15 * (currentLevel + 1),
                type: enemyType.type
            });
        }
        
        function createExplosion(x, y, size = 1) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = `${x - 30 * size}px`;
            explosion.style.top = `${y - 30 * size}px`;
            explosion.style.transform = `scale(${size})`;
            gameContainer.appendChild(explosion);
            
            setTimeout(() => {
                explosion.remove();
            }, 500);
        }
        
        function checkLevelUp() {
            const nextLevel = currentLevel + 1;
            if (nextLevel < levels.length && score >= levels[currentLevel].scoreRequired) {
                levelUp(nextLevel);
            }
        }
        
        function levelUp(newLevel) {
            gameActive = false;
            clearAllIntervals();
            
            currentLevel = newLevel;
            const level = levels[currentLevel];
            
            levelUpDisplay.textContent = `¡Ronda ${level.name}!\n+${level.lives - lives} vidas`;
            levelUpDisplay.style.display = 'block';
            levelDisplay.textContent = `Ronda: ${level.name}`;
            
            lives = level.lives;
            updateLivesDisplay();
            
            // Dar arma especial al subir de nivel
            const weapons = ['triple', 'fire', 'machinegun'];
            const randomWeapon = weapons[Math.floor(Math.random() * weapons.length)];
            playerConfig.weapon = randomWeapon;
            playerConfig.weaponDuration = 10000; // 10 segundos
            updateWeaponDisplay(randomWeapon);
            
            setTimeout(() => {
                levelUpDisplay.style.display = 'none';
                gameActive = true;
                
                gameIntervals.push(setInterval(createEnemy, level.spawnRate));
                updateGame();
            }, 2000);
        }
        
        function updateWeaponDisplay(weapon) {
            switch(weapon) {
                case 'triple':
                    weaponInfo.textContent = "Arma: Triple Disparo";
                    weaponInfo.style.color = "#00ffff";
                    break;
                case 'fire':
                    weaponInfo.textContent = "Arma: Bolas de Fuego";
                    weaponInfo.style.color = "#ff8000";
                    break;
                case 'machinegun':
                    weaponInfo.textContent = "Arma: Metralleta";
                    weaponInfo.style.color = "#ffff00";
                    break;
                default:
                    weaponInfo.textContent = "Arma: Básica";
                    weaponInfo.style.color = "#0f0";
            }
        }
        
        function updateGame() {
            if (!gameActive) return;
            
            // Disparo automático
            shoot();
            
            // Movimiento con teclado o botones virtuales
            if (moveLeft) defenderPosition -= playerConfig.speed;
            if (moveRight) defenderPosition += playerConfig.speed;
            if (moveLeft || moveRight) updateDefenderPosition();
            
            // Mover enemigos
            enemies.forEach((enemy, enemyIndex) => {
                const level = levels[currentLevel];
                enemy.y += enemy.speed;
                enemy.x += Math.sin(enemy.y * 0.05) * (1 + currentLevel * 0.2);
                enemy.element.style.top = `${enemy.y}px`;
                enemy.element.style.left = `${enemy.x}px`;
                
                enemy.shootDelay--;
                if (enemy.shootDelay <= 0) {
                    enemyShoot(enemy, enemy.type);
                    enemy.shootDelay = Math.floor(Math.random() * 100) + (200 - currentLevel * 20);
                }
                
                if (enemy.y > window.innerHeight - 100 && 
                    enemy.x > defenderPosition - 30 && 
                    enemy.x < defenderPosition + 30) {
                    createExplosion(enemy.x, enemy.y, 1.5);
                    takeDamage();
                    enemy.element.remove();
                    enemies.splice(enemyIndex, 1);
                }
                
                if (enemy.y > window.innerHeight + 30) {
                    enemy.element.remove();
                    enemies.splice(enemyIndex, 1);
                }
            });
            
            // Mover balas del jugador
            playerBullets.forEach((bullet, bulletIndex) => {
                bullet.y -= bullet.speed;
                bullet.element.style.bottom = `${window.innerHeight - bullet.y}px`;
                
                enemies.forEach((enemy, enemyIndex) => {
                    if (Math.abs(bullet.x - enemy.x) < 30 && 
                        Math.abs(bullet.y - enemy.y) < 30) {
                        enemy.health -= bullet.damage;
                        
                        if (enemy.health <= 0) {
                            createExplosion(enemy.x, enemy.y, 1.2);
                            enemy.element.remove();
                            enemies.splice(enemyIndex, 1);
                            score += enemy.points;
                            enemiesDestroyed++;
                            scoreDisplay.textContent = `Puntuación: ${score}`;
                            
                            // Posibilidad de obtener arma especial al destruir enemigos
                            if (playerConfig.weapon === 'basic' && playerConfig.weaponCooldown <= 0 && Math.random() < 0.2) {
                                const weapons = ['triple', 'fire', 'machinegun'];
                                const randomWeapon = weapons[Math.floor(Math.random() * weapons.length)];
                                playerConfig.weapon = randomWeapon;
                                playerConfig.weaponDuration = 8000; // 8 segundos
                                updateWeaponDisplay(randomWeapon);
                            }
                            
                            checkLevelUp();
                        }
                        
                        bullet.element.remove();
                        playerBullets.splice(bulletIndex, 1);
                    }
                });
                
                if (bullet.y < 0) {
                    bullet.element.remove();
                    playerBullets.splice(bulletIndex, 1);
                }
            });
            
            // Mover balas enemigas
            enemyBullets.forEach((bullet, bulletIndex) => {
                // Aplicar movimiento con ángulo si tiene offset
                if (bullet.angleOffset) {
                    bullet.x += bullet.angleOffset * 0.1;
                }
                
                bullet.y += bullet.speed;
                bullet.element.style.top = `${bullet.y}px`;
                bullet.element.style.left = `${bullet.x}px`;
                
                if (bullet.y > window.innerHeight - 100 && 
                    bullet.x > defenderPosition - 30 && 
                    bullet.x < defenderPosition + 30) {
                    createExplosion(bullet.x, bullet.y, bullet.isFireball ? 1.3 : 0.8);
                    takeDamage();
                    bullet.element.remove();
                    enemyBullets.splice(bulletIndex, 1);
                }
                
                if (bullet.y > window.innerHeight) {
                    bullet.element.remove();
                    enemyBullets.splice(bulletIndex, 1);
                }
            });
            
            requestAnimationFrame(updateGame);
        }
        
        function takeDamage() {
            lives--;
            updateLivesDisplay();
            
            defender.style.filter = 'brightness(2)';
            setTimeout(() => {
                if (gameActive) defender.style.filter = 'brightness(1)';
            }, 200);
            
            if (lives <= 0) {
                gameOver();
            }
        }
        
        function updateLivesDisplay() {
            let livesText = 'Vidas: ';
            for (let i = 0; i < levels[currentLevel].lives; i++) {
                livesText += i < lives ? '❤' : '♡';
            }
            livesDisplay.textContent = livesText;
        }
        
        function gameOver() {
            gameActive = false;
            clearAllIntervals();
            finalScoreDisplay.textContent = score;
            finalLevelDisplay.textContent = levels[currentLevel].name;
            gameOverDisplay.style.display = 'block';
        }
        
        function clearAllIntervals() {
            gameIntervals.forEach(interval => clearInterval(interval));
            gameIntervals = [];
        }
        
        function resetGameState() {
            enemies.forEach(enemy => enemy.element.remove());
            playerBullets.forEach(bullet => bullet.element.remove());
            enemyBullets.forEach(bullet => bullet.element.remove());
            
            enemies = [];
            playerBullets = [];
            enemyBullets = [];
            score = 0;
            currentLevel = 0;
            enemiesDestroyed = 0;
            lives = levels[currentLevel].lives;
            
            // Resetear arma
            playerConfig.weapon = 'basic';
            playerConfig.weaponDuration = 0;
            playerConfig.weaponCooldown = 0;
            
            scoreDisplay.textContent = `Puntuación: ${score}`;
            levelDisplay.textContent = `Ronda: ${levels[currentLevel].name}`;
            weaponInfo.textContent = "Arma: Básica";
            weaponInfo.style.color = "#0f0";
            updateLivesDisplay();
            
            defenderPosition = window.innerWidth / 2;
            defender.style.left = `${defenderPosition - 30}px`;
            defender.style.filter = 'brightness(1)';
        }
        
        function resetGame() {
            resetGameState();
            gameOverDisplay.style.display = 'none';
            levelUpDisplay.style.display = 'none';
            gameActive = true;
            
            clearAllIntervals();
            gameIntervals.push(setInterval(createEnemy, levels[currentLevel].spawnRate));
            
            updateGame();
        }
        
        // =============================================
        // EVENT LISTENERS
        // =============================================
        
        // Menú principal
        startGameBtn.addEventListener('click', startGame);
        settingsBtn.addEventListener('click', showSettings);
        creditsBtn.addEventListener('click', showCredits);
        
        // Submenús
        backFromSettings.addEventListener('click', backToMainMenu);
        backFromCredits.addEventListener('click', backToMainMenu);
        
        // Juego
        restartButton.addEventListener('click', resetGame);
        menuButton.addEventListener('click', showMainMenu);
        
        // Inicializar el juego
        createStars();
        setupControls();
        showMainMenu();
    </script>
</body>
</html>
